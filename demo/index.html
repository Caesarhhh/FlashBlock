<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Video Demo</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                   Roboto, Helvetica, Arial, sans-serif;
      margin: 40px;
      background: #fafafa;
      color: #222;
    }

    h1 {
      margin-bottom: 12px;
    }

    .intro {
      max-width: 900px;
      margin-bottom: 40px;
      font-size: 15px;
      line-height: 1.6;
      color: #444;
    }

    /* ===== category ===== */
    .category {
      margin-bottom: 70px;
    }

    .category-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 20px;
      padding-bottom: 6px;
      border-bottom: 3px solid #4a6cf7;
      display: inline-block;
      letter-spacing: 0.5px;
    }

    /* ===== rows ===== */
    .method-row {
      display: grid;
      grid-template-columns: 120px repeat(5, 1fr);
      gap: 12px;
      align-items: center;
      margin-bottom: 14px;
    }

    .method-label {
      font-weight: 600;
      font-size: 15px;
      color: #333;
      text-align: right;
      padding-right: 10px;
    }

    video {
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: black;
    }

    footer {
      margin-top: 80px;
      font-size: 13px;
      color: #666;
    }
  </style>
</head>

<body>

<h1>Video Acceleration Demo</h1>

<div class="intro">
  For each category, we visualize several representative videos.
  The first row shows the <b>Baseline</b>, and the second row shows
  <b>FlashBlock</b>. Videos in the same column are synchronized for
  playback and seeking.
</div>

<div id="container"></div>

<footer>
  Videos are precomputed and aligned by filename. No server-side processing is involved.
</footer>

<script>
const container = document.getElementById("container");

// ===== sync logic for one column =====
function enableSync(v1, v2) {
  let syncing = false;

  function syncPlay(src, tgt) {
    if (syncing) return;
    syncing = true;
    tgt.currentTime = src.currentTime;
    tgt.play();
    syncing = false;
  }

  function syncPause(tgt) {
    if (syncing) return;
    syncing = true;
    tgt.pause();
    syncing = false;
  }

  function syncSeek(src, tgt) {
    if (syncing) return;
    syncing = true;
    tgt.currentTime = src.currentTime;
    syncing = false;
  }

  v1.addEventListener("play", () => syncPlay(v1, v2));
  v2.addEventListener("play", () => syncPlay(v2, v1));

  v1.addEventListener("pause", () => syncPause(v2));
  v2.addEventListener("pause", () => syncPause(v1));

  v1.addEventListener("seeking", () => syncSeek(v1, v2));
  v2.addEventListener("seeking", () => syncSeek(v2, v1));
}

// ===== load everything =====
async function loadDemo() {
  const catRes = await fetch("/api/categories");
  const categories = await catRes.json();

  for (const category of categories) {
    const catDiv = document.createElement("div");
    catDiv.className = "category";

    const title = document.createElement("div");
    title.className = "category-title";
    title.textContent = category;
    catDiv.appendChild(title);

    const baseRow = document.createElement("div");
    baseRow.className = "method-row";
    baseRow.innerHTML = `<div class="method-label">Baseline</div>`;

    const oursRow = document.createElement("div");
    oursRow.className = "method-row";
    oursRow.innerHTML = `<div class="method-label">FlashBlock</div>`;

    const vidRes = await fetch(`/api/videos/${category}`);
    const videos = await vidRes.json();

    for (const v of videos) {
      const baseline = document.createElement("video");
      baseline.src = `/videos/${category}/baseline/${v}`;
      baseline.controls = true;

      const ours = document.createElement("video");
      ours.src = `/videos/${category}/ours/${v}`;
      ours.controls = true;

      baseRow.appendChild(baseline);
      oursRow.appendChild(ours);

      enableSync(baseline, ours);
    }

    catDiv.appendChild(baseRow);
    catDiv.appendChild(oursRow);
    container.appendChild(catDiv);
  }
}

loadDemo();
</script>

</body>
</html>
